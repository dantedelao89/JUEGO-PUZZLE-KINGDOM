{"version":3,"sources":["assets/script/services/audio.ts"],"names":[],"mappings":";;;;;;;AAAA,0CAA4C;AACpC,IAAA,CAAC,GAAQ,EAAE,EAAV,EAAE,CAAC,GAAK,EAAE,EAAP,CAAQ;AAEpB,IAAM,iBAAiB,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC,eAAe;AACnD,IAAM,gBAAgB,GAAG,EAAE,CAAC,CAAC,kCAAkC;AAElD,QAAA,KAAK,GAAG;IAClB,SAAS,EAAE,EAAE;IACb,aAAa,EAAE,EAAE;IACjB,uBAAuB,EAAE,CAAC;IAC1B,cAAc,EAAE,CAAC;IAEjB,IAAI;QAAJ,iBAEC;QADE,CAAC,CAAC,UAAU,CAAC,cAAM,OAAA,KAAI,CAAC,cAAc,EAAE,EAArB,CAAqB,EAAE,IAAI,CAAC,CAAC;IACnD,CAAC;IAED,cAAc;QAAd,iBAQC;QAPE,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,SAAS,EAAE,UAAC,GAAG,EAAE,GAAG;YACnD,IAAI,GAAG;gBAAE,OAAO,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC3B,KAAiB,UAAG,EAAH,WAAG,EAAH,iBAAG,EAAH,IAAG;gBAAf,IAAI,IAAI,YAAA;gBAAS,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;aAAA;YACvD,2CAA2C;YAE3C,CAAC,CAAC,SAAS,CAAC,cAAM,OAAA,KAAI,CAAC,WAAW,EAAE,EAAlB,CAAkB,EAAE,eAAe,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;IACN,CAAC;IAED,SAAS,EAAT,UAAU,IAAY,EAAE,MAAU;QAAV,uBAAA,EAAA,UAAU;QAC/B,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;YAAE,OAAO;QACxD,IAAI;YACD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;SACtF;QAAC,OAAO,CAAC,EAAE,GAAG;IAClB,CAAC;IAED,SAAS,EAAT,UAAU,IAAY;QACnB,IAAI,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;YAAE,EAAE,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;IACrF,CAAC;IAED,WAAW,YAAC,MAAU;QAAV,uBAAA,EAAA,UAAU;QACnB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK;YAAE,OAAO;QAC/B,IAAI,EAAE,CAAC,WAAW,CAAC,cAAc,EAAE;YAAE,OAAO;QAC5C,IAAI;YACD,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,CAAC;YAC5F,EAAE,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;SACxC;QAAC,OAAO,CAAC,EAAE;YAAE,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;SAAE;IAC9C,CAAC;IAED,WAAW;QACR,IAAI,EAAE,CAAC,WAAW,CAAC,cAAc,EAAE;YAAE,EAAE,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;IACnE,CAAC;IAED,oBAAoB;QACjB,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK;YAAE,OAAO;QAC/B,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;IACrC,CAAC;CAEH,CAAA","file":"","sourceRoot":"/","sourcesContent":["import * as _G from '../system/all_modules';\nconst { _, $ } = _G;\n\nconst STREAK_TIME_RANGE = 5 * 1000; // milliseconds\nconst MAX_STREAK_INDEX = 15; // number of streak sounds we have\n\nexport const audio = {\n   audioList: {},\n   playingIdList: {},\n   currentStreakSoundIndex: 0,\n   lastStreakTime: 0,\n\n   init() {\n      _.setTimeout(() => this.loadAudioFiles(), 1000);\n   },\n\n   loadAudioFiles() {\n      cc.resources.loadDir('audios', cc.AudioClip, (err, res) => {\n         if (err) return _.log(err);\n         for (let clip of res) this.audioList[clip.name] = clip;\n         // _.log(`audio.js >> all audio loaded !`);\n\n         _.waitToRun(() => this.playBgMusic(), 'isInitialized', _G.settings);\n      });\n   },\n\n   playSound(name: string, volume = 1) {\n      if (!_G.settings.sound || !this.audioList[name]) return;\n      try {\n         this.playingIdList[name] = cc.audioEngine.play(this.audioList[name], false, volume);\n      } catch (e) { }\n   },\n\n   stopSound(name: string) {\n      if (this.playingIdList[name]) cc.audioEngine.stopEffect(this.playingIdList[name]);\n   },\n\n   playBgMusic(volume = 1) {\n      if (!_G.settings.music) return;\n      if (cc.audioEngine.isMusicPlaying()) return;\n      try {\n         this.playingIdList[\"bg_music\"] = cc.audioEngine.playMusic(this.audioList[\"bg_music\"], true);\n         cc.audioEngine.setMusicVolume(volume);\n      } catch (e) { _.log(`playMusic err `, e); }\n   },\n\n   stopBgMusic() {\n      if (cc.audioEngine.isMusicPlaying()) cc.audioEngine.stopMusic();\n   },\n\n   playSoundClickButton() {\n      if (!_G.settings.sound) return;\n      this.playSound(\"button_click\", 1);\n   },\n\n}"]}