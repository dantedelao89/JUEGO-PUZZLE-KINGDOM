{"version":3,"sources":["assets/script/core-game/tutorial.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import * as _G from '../system/all_modules';\nconst { _, $ } = _G;\n\nexport const tutorial = {\n   frameAvatarInfo: { x: 100, y: 270, width: 585, height: 370, angle: 0 },\n\n   node: null as cc.Node,\n   cellNode1: null as cc.Node,\n   cellNode2: null as cc.Node,\n\n   isShowingTut: false,\n   hiddenNodeArr1: null,\n   hiddenNodeArr2: null,\n   currentStep: 0,\n\n   init() {\n      this.node = cc.find('Canvas/layout_tutorial');\n\n      this.hiddenNodeArr1 = [\n         // cc.find('btn_back', _G.coreUI.headerContainer),\n         cc.find('label_game_play_more_puzzle', _G.coreUI.playGridContainer),\n      ];\n      this.hiddenNodeArr2 = [\n         cc.find('time_level_bar', _G.coreUI.playGridContainer),\n         // cc.find('playing_button_bar', _G.coreUI.playGridContainer),\n      ];\n\n      _G.user.addInitCallback(data => {\n         // _.log(`tutorial.init() ==>>> data.isNewUser = ${data.isNewUser} //  _G.user.entryPointData.puzzle_id = ${_G.user.entryPointData.puzzle_id} `);\n\n         if (!data.isNewUser || _G.user.isPuzzleSpecified) return _G.coreUI.hideLayout('layout_tutorial');\n\n         if (!window['FBInstant']) this.start();\n         else _.waitToRun(() => this.start(), 'isRealAvatarLoaded', _G.mapVisual, 0.1, 4, () => this.start());\n      });\n   },\n\n   isCurrentPuzzleTutorial() {\n      return _G.gameMechanic.currentCategoryName == 'tutorial';\n   },\n\n   isClickableCell(cellNode) {\n      if (!this.isShowingTut) return true;\n      return cellNode == this.cellNode1 || cellNode == this.cellNode2;\n   },\n\n   checkOnSwapCells() {\n      if (this.isShowingTut && this.currentStep == 1) _.setTimeout(() => this.showStep2(), 1000);\n   },\n\n\n   //============= on tut start\n   start() {\n      this.isShowingTut = true;\n      this.currentStep = 1;\n\n      // render special puzzle\n      _G.gameMechanic.previewGame('tutorial', 'tutorial', 3, 3);\n      _G.gameMechanic.startGame();\n\n      // set up UI\n      [...this.hiddenNodeArr1, ...this.hiddenNodeArr2].map(node => node.active = false);\n      cc.find('texts/label_tut_step_1', this.node).active = true;\n\n      // fake the level time bar\n      const fakeTimeBarContainer = cc.find('grid_stack/tut_fake_time_bar', _G.coreUI.playGridContainer);\n      const fakeTimeBar = _.copyNode(cc.find('time_level_bar', _G.coreUI.playGridContainer), fakeTimeBarContainer);\n      fakeTimeBar.children.map(childNode => childNode.y = 100);\n      fakeTimeBar.y = -120;\n      fakeTimeBar.active = true;\n\n\n      // -------------------------------------------------\n      const { colliderNode, containerNode } = _G.categoryList;\n      const fakeColliderNode = _.copyNode(colliderNode, colliderNode.parent);\n      colliderNode.scale = fakeColliderNode.scale = containerNode.scale = 0.0001;\n      // containerNode.opacity = 0;\n      _.setGlobalPosToNode(fakeColliderNode, containerNode);\n      // _.log(`fakeColliderNode.height = ${fakeColliderNode.height}`);\n      fakeColliderNode.height *= 2;\n      _.setTimeout(() => fakeColliderNode.removeFromParent(true), 100);\n\n      // start hand animation\n      cc.find('black_layer', this.node).active = true;\n      _G.coreUI.showLayout(this.node);\n      const handNode = cc.find('tut_hand', this.node);\n\n      _.waitToRun(() => {\n         _.setGlobalPosToNode(handNode, this.cellNode1);\n         const gPosDiff = _.getGlobalPosDiff(this.cellNode1, this.cellNode2);\n\n         cc.tween(handNode).repeatForever(\n            cc.tween()\n               .by(0.4, { scale: -0.3 })\n               .by(0.4, { scale: 0.3 })\n               .by(1, { position: gPosDiff })\n               .by(0.4, { scale: -0.3 })\n               .by(0.4, { scale: 0.3 })\n               .by(1, { position: gPosDiff.mul(-1) })\n         ).start();\n\n      }, 'cellNode1', this);\n   },\n\n\n   showStep2() {\n      this.currentStep = 2;\n\n      // remove block inpout for fake btnHint\n      cc.find('block_inputs/block_input_2', this.node).active = false;\n\n      cc.find('texts/label_tut_step_1', this.node).active = false;\n\n      const labelNode2 = cc.find('texts/label_tut_step_2', this.node);\n      labelNode2.active = true;\n\n      const fakeBtnHint = cc.find('fake_buttons/btn_hint', this.node);\n\n      const handNode = cc.find('tut_hand', this.node);\n      handNode.stopAllActions();\n      handNode.scale = 1;\n      handNode.angle = -140;\n      _.setGlobalPosToNode(handNode, fakeBtnHint);\n      handNode.x -= 30;\n      handNode.y += 30;\n\n      cc.tween(handNode).repeatForever(\n         cc.tween()\n            .by(0.4, { scale: -0.3 })\n            .by(0.4, { scale: 0.3 })\n            .delay(1)\n      ).start();\n\n      fakeBtnHint.active = true;\n      _G.utilsUI.makeBubbleButton(fakeBtnHint, () => {\n         cc.find('disabled', fakeBtnHint).active = true;\n         _G.gameMechanic.onHint();\n         handNode.active = false;\n         _.setTimeout(() => {\n            fakeBtnHint.active = false;\n            this.showStep3();\n         }, 1000);\n      });\n\n   },\n\n\n   //============= on tut done\n   showStep3() {\n      const delayTime = 1.3;\n      _G.coreUI.showNagScreen(delayTime);\n\n      cc.find('tut_hand', this.node).active = false;\n\n      // show black screen with message\n      _.setTimeout(() => {\n         this.hiddenNodeArr1.map(node => node.active = true);\n\n         const { colliderNode, containerNode } = _G.categoryList;\n         colliderNode.scale = containerNode.scale = 1;\n         containerNode.opacity = 255;\n\n         _.setTimeout(() => {\n            cc.find('black_layer', this.node).active = false;\n            cc.find('texts', this.node).active = false;\n         }, 300);\n\n         cc.find('fake_buttons/play_time', this.node).active = true;\n         cc.find('bg', this.node).active = true;\n         cc.find('dialog', this.node).active = true;\n         _G.coreUI.showLayoutAnim(this.node, 210);\n      }, delayTime * 600);\n   },\n\n\n   onBtnContinue() {\n      cc.find('grid_stack/tut_fake_time_bar', _G.coreUI.playGridContainer).removeAllChildren();\n      _G.coreUI.hideLayoutAnim('layout_tutorial');\n      cc.find('time_level_bar', _G.coreUI.playGridContainer).active = true;\n      this.isShowingTut = false;\n      _G.gameMechanic.onResume();\n   },\n\n\n}"]}