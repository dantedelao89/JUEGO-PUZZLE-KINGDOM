{"version":3,"sources":["assets/script/services/extra-components/NestableScrollView_Outer.js"],"names":["cc","Class","ScrollView","properties","m_InnerScrollViews","require","m_PlanDir","visible","m_ScrollingInnerSv","onLoad","reloadInnerScrollViews","forEach","inner","setOuterScrollView","_isHisChild","child","undeterminedParent","parent","_findScrollingInnerSv","target","i","length","isHisChild","node","isDifferentBetweenSettingAndPlan","sv","horizontal","vertical","_hasNestedViewGroup","event","captureListeners","eventPhase","Event","CAPTURING_PHASE","_onTouchBegan","enabledInHierarchy","touch","content","_handlePressLogic","_touchMoved","_stopPropagationIfTargetIsMe","_onTouchMoved","deltaMove","getLocation","sub","getStartLocation","mag","contentSize","getContentSize","scrollViewSize","height","width","Math","abs","x","y","_handleMoveLogic","cancelInnerEvents","cancelEvent","EventTouch","getTouches","bubbles","type","Node","EventType","TOUCH_CANCEL","simulate","dispatchEvent"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;AACN,aAASD,EAAE,CAACE,UADN;AAGNC,EAAAA,UAAU,EAAE;AACTC,IAAAA,kBAAkB,EAAE,CAACC,OAAO,CAAC,0BAAD,CAAR,CADX;AAETC,IAAAA,SAAS,EAAE;AACR,iBAAS,IADD;AAERC,MAAAA,OAAO,EAAE;AAFD,KAFF;AAMTC,IAAAA,kBAAkB,EAAE;AACjB,iBAAS,IADQ;AAEjBD,MAAAA,OAAO,EAAE;AAFQ;AANX,GAHN;AAeNE,EAAAA,MAAM,EAAE,kBAAY;AACjB,SAAKH,SAAL,GAAiB,IAAjB;AACA,SAAKI,sBAAL;AACF,GAlBK;AAoBNA,EAAAA,sBApBM,oCAoBmB;AAAA;;AACtB,SAAKN,kBAAL,CAAwBO,OAAxB,CAAgC,UAAAC,KAAK,EAAI;AACtCA,MAAAA,KAAK,CAACC,kBAAN,CAAyB,KAAzB;AACF,KAFD;AAGF,GAxBK;AA0BNC,EAAAA,WA1BM,uBA0BMC,KA1BN,EA0BaC,kBA1Bb,EA0BiC;AACpC,QAAID,KAAK,IAAIC,kBAAb,EAAiC;AAC9B,aAAO,IAAP;AACF;;AACD,QAAID,KAAK,CAACE,MAAN,IAAgB,IAApB,EAA0B;AACvB,UAAIF,KAAK,CAACE,MAAN,IAAgBD,kBAApB,EAAwC;AACrC,eAAO,IAAP;AACF,OAFD,MAEO;AACJ,eAAO,KAAKF,WAAL,CAAiBC,KAAK,CAACE,MAAvB,EAA+BD,kBAA/B,CAAP;AACF;AACH;;AACD,WAAO,KAAP;AACF,GAtCK;AAyCNE,EAAAA,qBAzCM,iCAyCgBC,MAzChB,EAyCwB;AAC3B,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhB,kBAAL,CAAwBiB,MAA5C,EAAoDD,CAAC,EAArD,EAAyD;AACtD,UAAIE,UAAU,GAAG,KAAKR,WAAL,CAAiBK,MAAjB,EAAyB,KAAKf,kBAAL,CAAwBgB,CAAxB,EAA2BG,IAApD,CAAjB;;AACA,UAAID,UAAJ,EAAgB;AACb,eAAO,KAAKlB,kBAAL,CAAwBgB,CAAxB,CAAP;AACF;AACH;;AACD,WAAO,IAAP;AACF,GAjDK;AAoDNI,EAAAA,gCApDM,4CAoD2BC,EApD3B,EAoD+B;AAClC,QAAI,KAAKnB,SAAL,IAAkB,CAAtB,EAAyB;AACtB,aAAO,KAAP;AACF;;AACD,QAAI,KAAKA,SAAL,IAAkB,CAAlB,IAAuBmB,EAAE,CAACC,UAA9B,EAA0C;AACvC,aAAO,KAAP;AACF;;AACD,QAAI,KAAKpB,SAAL,IAAkB,CAAC,CAAnB,IAAwBmB,EAAE,CAACE,QAA/B,EAAyC;AACtC,aAAO,KAAP;AACF;;AACD,WAAO,IAAP;AACF,GA/DK;AAkENC,EAAAA,mBAAmB,EAAE,6BAAUC,KAAV,EAAiBC,gBAAjB,EAAmC;AACrD,QAAID,KAAK,CAACE,UAAN,KAAqB/B,EAAE,CAACgC,KAAH,CAASC,eAAlC,EAAmD;AACnD,WAAO,KAAP;AACF,GArEK;AAuENC,EAAAA,aAAa,EAAE,uBAAUL,KAAV,EAAiBC,gBAAjB,EAAmC;AAC/C,QAAI,CAAC,KAAKK,kBAAV,EAA8B;AAC9B,QAAI,KAAKP,mBAAL,CAAyBC,KAAzB,EAAgCC,gBAAhC,CAAJ,EAAuD;AAEvD,SAAKxB,SAAL,GAAiB,IAAjB;AACA,SAAKE,kBAAL,GAA0B,IAA1B;AAEA,QAAI4B,KAAK,GAAGP,KAAK,CAACO,KAAlB;;AACA,QAAI,KAAKC,OAAT,EAAkB;AACf,WAAKC,iBAAL,CAAuBF,KAAvB;AACF;;AACD,SAAKG,WAAL,GAAmB,KAAnB;;AACA,SAAKC,4BAAL,CAAkCX,KAAlC;AACF,GApFK;AAsFNY,EAAAA,aAAa,EAAE,uBAAUZ,KAAV,EAAiBC,gBAAjB,EAAmC;AAC/C,QAAI,CAAC,KAAKK,kBAAV,EAA8B;AAC9B,QAAI,KAAKP,mBAAL,CAAyBC,KAAzB,EAAgCC,gBAAhC,CAAJ,EAAuD;AAEvD,QAAIM,KAAK,GAAGP,KAAK,CAACO,KAAlB;AACA,QAAIM,SAAS,GAAGN,KAAK,CAACO,WAAN,GAAoBC,GAApB,CAAwBR,KAAK,CAACS,gBAAN,EAAxB,CAAhB;;AAEA,QAAI,KAAKvC,SAAL,IAAkB,IAAlB,IAA0BoC,SAAS,CAACI,GAAV,KAAkB,CAAhD,EAAmD;AAChD,WAAKtC,kBAAL,GAA0B,KAAKU,qBAAL,CAA2BW,KAAK,CAACV,MAAjC,CAA1B;;AACA,UAAI,KAAKX,kBAAL,IAA2B,IAA/B,EAAqC;AAClC,YAAIuC,WAAW,GAAG,KAAKvC,kBAAL,CAAwB6B,OAAxB,CAAgCW,cAAhC,EAAlB;AACA,YAAIC,cAAc,GAAG,KAAKzC,kBAAL,CAAwBe,IAAxB,CAA6ByB,cAA7B,EAArB;;AACA,YAAK,KAAKxC,kBAAL,CAAwBmB,QAAxB,IAAqCoB,WAAW,CAACG,MAAZ,GAAqBD,cAAc,CAACC,MAA1E,IAAuF,KAAK1C,kBAAL,CAAwBkB,UAAxB,IAAuCqB,WAAW,CAACI,KAAZ,GAAoBF,cAAc,CAACE,KAArK,EAA8K;AAC3K,eAAK7C,SAAL,GAAiB8C,IAAI,CAACC,GAAL,CAASX,SAAS,CAACY,CAAnB,IAAwBF,IAAI,CAACC,GAAL,CAASX,SAAS,CAACa,CAAnB,CAAxB,GAAgD,CAAhD,GAAoD,CAAC,CAAtE;AACF,SAFD,MAEO;AACJ,eAAKjD,SAAL,GAAiB,CAAjB;AACF;AACH,OARD,MAQO;AACJ,aAAKA,SAAL,GAAiB,CAAjB;AACF;AACH;;AAED,QAAI,KAAK+B,OAAT,EAAkB;AACf,UAAI,CAAC,KAAKb,gCAAL,CAAsC,IAAtC,CAAL,EAAkD;AAC/C,aAAKgC,gBAAL,CAAsBpB,KAAtB;AACF;AACH;;AAED,QAAI,CAAC,KAAKqB,iBAAV,EAA6B;AAC1B;AACF;;AAGD,QAAI,KAAKjD,kBAAL,IAA2B,IAA/B,EAAqC;AAClC,UAAIkC,SAAS,CAACI,GAAV,KAAkB,CAAtB,EAAyB;AACtB,YAAI,CAAC,KAAKP,WAAN,IAAqBV,KAAK,CAACV,MAAN,KAAiB,KAAKI,IAA/C,EAAqD;AAClD,cAAImC,WAAW,GAAG,IAAI1D,EAAE,CAACgC,KAAH,CAAS2B,UAAb,CAAwB9B,KAAK,CAAC+B,UAAN,EAAxB,EAA4C/B,KAAK,CAACgC,OAAlD,CAAlB;AACAH,UAAAA,WAAW,CAACI,IAAZ,GAAmB9D,EAAE,CAAC+D,IAAH,CAAQC,SAAR,CAAkBC,YAArC;AACAP,UAAAA,WAAW,CAACtB,KAAZ,GAAoBP,KAAK,CAACO,KAA1B;AACAsB,UAAAA,WAAW,CAACQ,QAAZ,GAAuB,IAAvB;AACArC,UAAAA,KAAK,CAACV,MAAN,CAAagD,aAAb,CAA2BT,WAA3B;AACA,eAAKnB,WAAL,GAAmB,IAAnB;AACF;AACH;;AACD,WAAKC,4BAAL,CAAkCX,KAAlC;AACF;AACH;AApIK,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n   extends: cc.ScrollView,\n\n   properties: {\n      m_InnerScrollViews: [require(\"NestableScrollView_Inner\")],\n      m_PlanDir: {\n         default: null,\n         visible: false,\n      },\n      m_ScrollingInnerSv: {\n         default: null,\n         visible: false,\n      },\n   },\n\n   onLoad: function () {\n      this.m_PlanDir = null;\n      this.reloadInnerScrollViews();\n   },\n\n   reloadInnerScrollViews() {\n      this.m_InnerScrollViews.forEach(inner => {\n         inner.setOuterScrollView(this);\n      });\n   },\n\n   _isHisChild(child, undeterminedParent) {\n      if (child == undeterminedParent) {\n         return true;\n      }\n      if (child.parent != null) {\n         if (child.parent == undeterminedParent) {\n            return true;\n         } else {\n            return this._isHisChild(child.parent, undeterminedParent);\n         }\n      }\n      return false;\n   },\n\n\n   _findScrollingInnerSv(target) {\n      for (let i = 0; i < this.m_InnerScrollViews.length; i++) {\n         let isHisChild = this._isHisChild(target, this.m_InnerScrollViews[i].node);\n         if (isHisChild) {\n            return this.m_InnerScrollViews[i];\n         }\n      }\n      return null;\n   },\n\n\n   isDifferentBetweenSettingAndPlan(sv) {\n      if (this.m_PlanDir == 0) {\n         return false;\n      }\n      if (this.m_PlanDir == 1 && sv.horizontal) {\n         return false;\n      }\n      if (this.m_PlanDir == -1 && sv.vertical) {\n         return false;\n      }\n      return true;\n   },\n\n\n   _hasNestedViewGroup: function (event, captureListeners) {\n      if (event.eventPhase !== cc.Event.CAPTURING_PHASE) return;\n      return false;\n   },\n\n   _onTouchBegan: function (event, captureListeners) {\n      if (!this.enabledInHierarchy) return;\n      if (this._hasNestedViewGroup(event, captureListeners)) return;\n\n      this.m_PlanDir = null;\n      this.m_ScrollingInnerSv = null;\n\n      var touch = event.touch;\n      if (this.content) {\n         this._handlePressLogic(touch);\n      }\n      this._touchMoved = false;\n      this._stopPropagationIfTargetIsMe(event);\n   },\n\n   _onTouchMoved: function (event, captureListeners) {\n      if (!this.enabledInHierarchy) return;\n      if (this._hasNestedViewGroup(event, captureListeners)) return;\n\n      var touch = event.touch;\n      var deltaMove = touch.getLocation().sub(touch.getStartLocation());\n\n      if (this.m_PlanDir == null && deltaMove.mag() > 7) {\n         this.m_ScrollingInnerSv = this._findScrollingInnerSv(event.target);\n         if (this.m_ScrollingInnerSv != null) {\n            let contentSize = this.m_ScrollingInnerSv.content.getContentSize();\n            let scrollViewSize = this.m_ScrollingInnerSv.node.getContentSize();\n            if ((this.m_ScrollingInnerSv.vertical && (contentSize.height > scrollViewSize.height)) || (this.m_ScrollingInnerSv.horizontal && (contentSize.width > scrollViewSize.width))) {\n               this.m_PlanDir = Math.abs(deltaMove.x) > Math.abs(deltaMove.y) ? 1 : -1;\n            } else {\n               this.m_PlanDir = 0;\n            }\n         } else {\n            this.m_PlanDir = 0;\n         }\n      }\n\n      if (this.content) {\n         if (!this.isDifferentBetweenSettingAndPlan(this)) {\n            this._handleMoveLogic(touch);\n         }\n      }\n\n      if (!this.cancelInnerEvents) {\n         return;\n      }\n\n\n      if (this.m_ScrollingInnerSv == null) {\n         if (deltaMove.mag() > 7) {\n            if (!this._touchMoved && event.target !== this.node) {\n               var cancelEvent = new cc.Event.EventTouch(event.getTouches(), event.bubbles);\n               cancelEvent.type = cc.Node.EventType.TOUCH_CANCEL;\n               cancelEvent.touch = event.touch;\n               cancelEvent.simulate = true;\n               event.target.dispatchEvent(cancelEvent);\n               this._touchMoved = true;\n            }\n         }\n         this._stopPropagationIfTargetIsMe(event);\n      }\n   },\n});"]}