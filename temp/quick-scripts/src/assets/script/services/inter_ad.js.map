{"version":3,"sources":["assets/script/services/inter_ad.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import * as _G from '../system/all_modules';\nconst _ = _G._;\n\nexport const interAd = {\n   interAdObj: null,\n   isLoading: false,\n\n   init() {\n      this.preloadInterAds();\n      this.lastTimeShowAd = _.getMsPassedUTC();\n   },\n\n   preloadInterAds() {\n      if (!window['FBInstant']) return;\n      if (this.isLoading) return;\n\n      _.log(`interAd.preloadInterAds ...  `);\n      this.interAdObj = null;\n      this.isLoading = true;\n      FBInstant.getInterstitialAdAsync(_G.configGame.interAdId).then(interAdObj => {\n         // _log(` preloadInterAds 3333 `);\n         interAdObj.loadAsync().then(() => {\n            _.log(`interAd.preloadInterAds successfully `);\n            this.interAdObj = interAdObj;\n            this.isLoading = false;\n         }).catch((e) => {\n            console.warn(e);\n            this.isLoading = false;\n            // setTimeout(() => this.preloadInterAds(), 5000);\n         });\n      }).catch((e) => {\n         console.warn(e);\n         this.isLoading = false;\n         // setTimeout(() => this.preloadInterAds(), 5000);\n      });\n   },\n\n\n   // loadTimeout = max time to wait for inter ad to be loaded. unless ads will be skipped\n   doShowInterAd(callBack?, maxLoadTimeWait = 1) {\n      // _.log(` showInterAds 1111 `);\n      if (!window['FBInstant']) return _G.coreUI.showLoadingAds(() => callBack && callBack(true));\n      _.waitToRun(\n         () => {\n            // show a loading ads 1 secs before do show ad\n            _G.coreUI.showLoadingAds(() => {\n               // _.log(` showInterAds 2222 `);\n               this.interAdObj.showAsync().then(() => {\n                  _.log(`interAd.showInterAds success `);\n                  if (callBack) callBack(true)\n                  this.preloadInterAds(); // load another ads\n               }).catch((e) => {\n                  _.log(`interAd.showInterAds fail `);\n                  console.warn(e);\n                  callBack && callBack();\n                  if (e.code != 'RATE_LIMITED') this.preloadInterAds();\n               });\n\n            });\n         },\n         'interAdObj',\n         this,\n         0.1,\n         maxLoadTimeWait,\n         () => {  // timeout callback\n            _.log(`interAd.showInterAds fail `);\n            console.warn(`interAd load wait timeout 5 secs`);\n            this.preloadInterAds();\n            if (callBack) callBack();\n         }\n      )\n   },\n\n\n   // ===================================\n   adShowCount: 0,\n   lastTimeShowAd: 0,\n   frameClickCount: 0,\n   checkToShowInterAd(callback?: Function) {\n      const timeArr = _G.configGame.interAdTime[_G.user.isVersionV2 ? 'v2' : 'v1'];\n      let timeToWait = timeArr[this.adShowCount] || timeArr[timeArr.length - 1];\n      const timeNow = _.getMsPassedUTC();\n      _.log(`checkToShowInterAd called ! adShowCount=${this.adShowCount} // timeToWait=${timeToWait} // timePassed = ${_.round(timeNow / 1000 - this.lastTimeShowAd / 1000)} secs // timeArr=${timeArr}`);\n      if (timeNow - this.lastTimeShowAd < timeToWait * 1000) return callback && callback();\n      this.frameClickCount++;\n      if (this.frameClickCount < _G.configGame.interAdClickCount) return callback && callback();\n\n      _.waitToRun(() => {\n         this.doShowInterAd(isShowSuccess => {\n            if (!isShowSuccess) return callback && callback();\n            _.log(`interAd show callback called !`);\n            this.adShowCount++;\n            this.lastTimeShowAd = timeNow;\n            this.frameClickCount = 0;\n            return callback && callback()\n         });\n      }, '!isPlayingFxStarsAdd', _G.coreFX, 0.5);\n\n   },\n\n}"]}